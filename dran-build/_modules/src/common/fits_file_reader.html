
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.common.fits_file_reader &#8212; dran v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">dran v1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">src.common.fits_file_reader</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for src.common.fits_file_reader</h1><div class="highlight"><pre>
<span></span><span class="c1"># =========================================================================== #</span>
<span class="c1"># File: fits_file_reader.py                                                   #</span>
<span class="c1"># Author: Pfesesani V. van Zyl                                                #</span>
<span class="c1"># =========================================================================== #</span>

<span class="c1"># Standard library imports</span>
<span class="c1"># --------------------------------------------------------------------------- #</span>
<span class="c1"># import exceptions</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span> <span class="k">as</span> <span class="n">pyfits</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Local imports</span>
<span class="c1"># --------------------------------------------------------------------------- #</span>
<span class="c1"># sys.path.append(&quot;src/&quot;)</span>
<span class="kn">from</span> <span class="nn">common.scan_parameters</span> <span class="kn">import</span> <span class="n">ScanParameters</span>
<span class="kn">import</span> <span class="nn">common.exceptions</span> <span class="k">as</span> <span class="nn">ex</span>
<span class="kn">from</span> <span class="nn">common.file_handler</span> <span class="kn">import</span> <span class="n">FileHandler</span>
<span class="kn">from</span> <span class="nn">common.messaging</span> <span class="kn">import</span> <span class="n">msg_wrapper</span>
<span class="c1"># =========================================================================== #</span>

<span class="c1"># # handle/ignore python warnings</span>
<span class="c1"># import warnings</span>
<span class="c1"># def fxn():</span>
<span class="c1">#     warnings.warn(&quot;deprecated&quot;, DeprecationWarning)</span>

<div class="viewcode-block" id="FitsFileReader"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader">[docs]</a><span class="k">class</span> <span class="nc">FitsFileReader</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Fits file reader reads a fits file and returns the data. </span>

<span class="sd">        Args:</span>
<span class="sd">            log (object): logging object</span>
<span class="sd">            filePath (str): path to file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">filePath</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">FileHandler</span><span class="p">(</span><span class="n">log</span><span class="p">,</span><span class="n">filePath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filePath</span> <span class="o">=</span> <span class="n">filePath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">get_file_name_from_path</span><span class="p">()</span>

        <span class="c1"># Setup the drift scan parameters and dictionary for storage</span>
        <span class="c1"># then read in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span> <span class="o">=</span> <span class="n">ScanParameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="p">{}</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>

<div class="viewcode-block" id="FitsFileReader.open_file"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.open_file">[docs]</a>    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Open fits file for processing. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filePath</span><span class="p">)</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="s1">&#39;Opening file: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="s1">&#39;Caught OSError: &#39;</span> <span class="o">+</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">return</span> 
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                <span class="s2">&quot;The file &#39;</span><span class="si">{self.filePath}</span><span class="s2">&#39; is missing or does not exists. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FitsFileReader.read_file"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Read data from the fits file. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">open_file</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_beam_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;13.0&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="si">}</span><span class="s2">_2280&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;06.0D&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="si">}</span><span class="s2">_4800&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;03.5D&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="si">}</span><span class="s2">_8400&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;02.5S&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="si">}</span><span class="s2">_12218&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;01.3S&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">srcFolderName</span><span class="si">}</span><span class="s2">_22000&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;setup beamtype for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="si">}</span><span class="s1">, in common/fits_file_reader.py read_file()&#39;</span><span class="p">)</span>

        <span class="c1"># print(&quot;\n&quot;,&quot;*&quot;*50,&#39;\n&#39;)</span>
        <span class="c1"># print(&#39;object: &#39;,self.object.upper())</span>
        <span class="c1"># print(&#39;file path: &#39;,self.filePath)</span>
        <span class="c1"># print(&#39;file name: &#39;,self.fileName)</span>
        <span class="c1"># print(&#39;src folder name: &#39;,self.srcFolderName)</span>
        <span class="c1"># print(&#39;src data folder name: &#39;,self.objectDIR)</span>
        <span class="c1"># print(&quot;\n&quot;,&quot;*&quot;*50)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_source_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_file</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="FitsFileReader.validate_file"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.validate_file">[docs]</a>    <span class="k">def</span> <span class="nf">validate_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;validate that all requirements have been met for a processed file to be valid. &quot;&quot;&quot;</span>
        <span class="c1"># BEGIN POPULATING SCAN PROPERTIES</span>
        <span class="c1"># Validate the HDU length of the fits files.</span>
        <span class="c1"># Some files in the early observing dates have</span>
        <span class="c1"># invalid hdu lengths giving rise to problems</span>
        <span class="c1"># processing the data. For this reason the program</span>
        <span class="c1"># flags these files and does not process them.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">)</span>  <span class="c1"># length of header data unit</span>
        <span class="c1"># print(self.hdu.info())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>

            <span class="c1"># Get calibrator data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_type</span> <span class="o">==</span> <span class="s2">&quot;CAL&quot;</span><span class="p">:</span>
                <span class="c1"># print(&quot;SRC: &quot;,self.src_type, &#39;, BEAM: &#39;,self.beam_type )</span>
                
                <span class="c1"># get data for dual beam drift scans</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;03.5D&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;06.0D&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_db_cal_dict</span><span class="p">()</span>

                <span class="c1"># get data for single narrow beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;02.5S&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;04.5S&quot;</span><span class="p">:</span>

                    <span class="c1"># Force jupiter 12.178 GHz data to perform 22 GHz fit</span>
                    <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">==</span><span class="s2">&quot;Jupiter_12.178GHz&quot;</span><span class="p">):</span><span class="c1">#,self.scans)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_jupiter_dict</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_nb_cal_dict</span><span class="p">()</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_jupiter_dict</span><span class="p">()</span>

                    <span class="c1"># for k,v in self.scan_parameters.parameters.items():</span>
                    <span class="c1">#     if &quot;TAPEAK&quot; in k:</span>
                    <span class="c1">#         print(k,v)</span>
                    <span class="c1">#print(&#39;pars: &#39;,self.scan_parameters.parameters)</span>
                    <span class="c1">#</span>
                    <span class="c1"># sys.exit()</span>

                <span class="c1"># get data for single wide beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;13.0S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_wb_cal_dict</span><span class="p">()</span>

                <span class="c1"># get data for single wide beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;04.5S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_nb_cal_dict</span><span class="p">()</span>

                <span class="c1"># get data for single wide beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;18.0S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_nb_cal_dict</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Freq: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">)</span>
                    <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;The frequency &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="si">}</span><span class="s2">&#39; your trying to process hasn&#39;t been modelled yet for calibrators, please log a bug if you want it modeled in.&quot;</span><span class="p">)</span>
                    <span class="c1">#sys.exit()</span>
                    <span class="k">pass</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_type</span> <span class="o">==</span> <span class="s2">&quot;TAR&quot;</span><span class="p">:</span>

                <span class="c1"># get data for dual beam drift scans</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;03.5D&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;06.0D&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_db_src_dict</span><span class="p">()</span>

                <span class="c1"># get data for single narrow beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;02.5S&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;04.5S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_nb_src_dict</span><span class="p">()</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_nb_22ghz_src_dict</span><span class="p">()</span>

                <span class="c1"># get data for single wide beam scans</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;13.0S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">set_wb_src_dict</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Freq: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="p">)</span>
                    <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                                <span class="s2">&quot;The frequency your trying to process hasn&#39;t been modelled yet, please log a bug if you want it modeled in.&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="s2">&quot;Invalid source type detected&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

            <span class="c1"># populate drift scan parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_parameters</span><span class="o">.</span><span class="n">parameters</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;HDULENGTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBJECTTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SOURCEDIR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectDIR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="s2">&quot;The file being processed has an invalid HDU length: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">HDU_LEN</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_scan_properties</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__get_beam_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the beam type of the scan. e.g. 13.0S i.e. 13 cm single beam. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXTNAME&quot;</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">__set_source_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get the scan source type. There are two basic types.</span>
<span class="sd">            Calibrator (CAL) and target (TAR) sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">calNamesDir</span> <span class="o">=</span> <span class="s2">&quot;predefs&quot;</span>
        <span class="c1">#calNamesList = &quot;cal_names_list.txt&quot;</span>
        <span class="c1">#cal_names_list_path = os.path.join(</span>
        <span class="c1">#    calNamesDir, calNamesList)</span>

        <span class="c1"># validate calibration list exists</span>
        <span class="n">calNamesDir</span><span class="p">,</span> <span class="n">cal_names_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_cal_list</span><span class="p">(</span><span class="n">calNamesDir</span><span class="p">)</span><span class="c1">#, calNamesList)</span>

        <span class="c1"># if it exists, get its path and read</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">calNamesDir</span><span class="p">)</span>
        <span class="c1"># print(filePath)</span>
        <span class="c1"># sys.exit()</span>
        <span class="n">calNamesListFileIndex</span><span class="o">=</span><span class="n">cal_names_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;cal_names_list.txt&#39;</span><span class="p">)</span>
        <span class="c1">#print(calNamesListFileIndex, )</span>
        
        <span class="n">cal_names</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">calNamesDir</span><span class="p">,</span><span class="n">cal_names_list</span><span class="p">[</span><span class="n">calNamesListFileIndex</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">cal_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#sys.exit()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.fits&quot;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cal_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">cal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="ow">in</span> <span class="n">cal_list</span><span class="p">):</span>
                <span class="c1"># Set source as calibrator</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                            <span class="s2">&quot;This source is a calibrator&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">src_type</span> <span class="o">=</span> <span class="s2">&quot;CAL&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Set source as target</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;This source is a target&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">src_type</span> <span class="o">=</span> <span class="s2">&quot;TAR&quot;</span>

<div class="viewcode-block" id="FitsFileReader.validate_cal_list"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.validate_cal_list">[docs]</a>    <span class="k">def</span> <span class="nf">validate_cal_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calNamesDir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Validate the calibrator list exists. We need it to </span>
<span class="sd">            determine whether a source is a calibrator or target</span>
<span class="sd">            object. </span>

<span class="sd">            Args: </span>
<span class="sd">                calNamesDir (str):  Name of the directory containing the calibrator list of sources.</span>
<span class="sd">                calNamesList (str): The calibrator list of sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathToDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="n">calNamesDir</span><span class="o">=</span><span class="n">pathToDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;common&#39;</span><span class="p">,</span><span class="s1">&#39;predefs&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cal_names_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">calNamesDir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
           <span class="n">cal_names_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="o">+</span><span class="n">calNamesDir</span><span class="p">)</span>
           <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal_names_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EmptyFolderError: The &#39;predefs&#39; folder is empty</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">calNamesDir</span><span class="p">,</span> <span class="n">cal_names_list</span></div>

<div class="viewcode-block" id="FitsFileReader.set_scan_properties"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_scan_properties">[docs]</a>    <span class="k">def</span> <span class="nf">set_scan_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set all relevant scan properties. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="s1">&#39;Setting scan properties&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_cur_date_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_chart_header_stats</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xAxis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_derived_properties</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_counts_to_kelvins</span><span class="p">()</span>

        <span class="c1"># close hdu file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="FitsFileReader.get_cur_date_time"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_cur_date_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_cur_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get current date and time. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s1">&#39;Setting current date and time&#39;</span><span class="p">)</span>
        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CURDATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_time</span></div>

<div class="viewcode-block" id="FitsFileReader.get_scan_data"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_scan_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_scan_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the file header and data units from the fits file. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s1">&#39;Getting scan data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_main_HDUs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_source_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_source_parameters_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="FitsFileReader.get_main_HDUs"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_main_HDUs">[docs]</a>    <span class="k">def</span> <span class="nf">get_main_HDUs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the HDU&#39;s that are available in all scan types. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s1">&#39;Getting main HDU data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary_HDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># Primary HDU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_info_HDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># Observation information HDU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_cal_HDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Noise calibrator HDU</span></div>

<div class="viewcode-block" id="FitsFileReader.get_source_parameters"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_source_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the parameters recorded for each source. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Getting source parameters&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>

            <span class="c1"># Get drift scans</span>
            <span class="c1"># NORTH_SCAN for all other drift scan unmodified data above 2280 MHz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

            <span class="c1"># ON_SCAN for all other drift scan unmodified data above 2280 MHz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="c1"># SOUTH_SCAN for all other drift scan unmodified data above 2280 MHz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

            <span class="c1"># Chart data HDU</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">,</span> <span class="s2">&quot;Chart header not found, this analysis will be flagged.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;13.0S&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;18.0S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;06.0D&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;03.5D&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">==</span> <span class="s2">&quot;02.5S&quot;</span><span class="p">:</span>

                <span class="c1"># Generate placeholder data for corrupted driftscans</span>
                <span class="n">place_holder_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">beams</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HPSLCP&quot;</span><span class="p">,</span><span class="s2">&quot;HPNLCP&quot;</span><span class="p">,</span><span class="s2">&quot;ONLCP&quot;</span><span class="p">,</span><span class="s2">&quot;HPSRCP&quot;</span><span class="p">,</span><span class="s2">&quot;HPNRCP&quot;</span><span class="p">,</span><span class="s2">&quot;ONRCP&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beams</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">beams</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">place_holder_data</span> 
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                            <span class="s2">&quot;Invalid frequency detected: </span><span class="si">{}</span><span class="s2"> MHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
     
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="s2">&quot;Invalid hdu length detected: hdu length = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">File </span><span class="si">{}</span><span class="s2"> is corrupted.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HDU_LEN</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FitsFileReader.get_source_parameters_data"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_source_parameters_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_parameters_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the main parameters from the file. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Get the main parameters from the file&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_headers</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_primary_header_stats</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_obs_info_header_stats</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_noise_cal_header_stats</span><span class="p">()</span></div>

<div class="viewcode-block" id="FitsFileReader.set_headers"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_headers">[docs]</a>    <span class="k">def</span> <span class="nf">set_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set the fits file header access. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s1">&#39;Set the fits file header access&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_HDU</span><span class="o">.</span><span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OIH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_info_HDU</span><span class="o">.</span><span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NCH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_cal_HDU</span><span class="o">.</span><span class="n">header</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1">#TODO: Error handle this properly</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">,</span><span class="s2">&quot;This file is missing a chart header, setting chart header hdu to zero.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="FitsFileReader.set_primary_header_stats"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_primary_header_stats">[docs]</a>    <span class="k">def</span> <span class="nf">set_primary_header_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Setup the main statistics of each source that are common to all.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="s1">&#39;Setup the main statistics of each source &#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBSDATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;DATE&quot;</span><span class="p">])[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBSTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;DATE&quot;</span><span class="p">])[</span><span class="mi">11</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;LONGITUD&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBSERVER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;OBSERVER&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBSLOCAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;OBSLOCAL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PROJNAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;PROJNAME&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PROPOSAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;PROPOSAL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TELESCOPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;TELESCOP&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UPGRADE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;UPGRADE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOCUS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;FOCUS&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TILT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;TILT&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;PRESSURE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;HUMIDITY&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCANTYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;SCANTYPE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RADIOMETER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;INSTRUME&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCANDIST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;SCANDIST&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCANTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">[</span><span class="s2">&quot;SCANTIME&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;WINDSPD&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;INSTFLAG&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PRH</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitsFileReader.set_parameter"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameterName</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set the value of a given parameter in the data dictionary &quot;&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parameterName</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="n">parameterName</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parameterName</span><span class="si">}</span><span class="s2"> is missing from the fits file. Setting it to NAN.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parameterName</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>
            
<div class="viewcode-block" id="FitsFileReader.set_obs_info_header_stats"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_obs_info_header_stats">[docs]</a>    <span class="k">def</span> <span class="nf">set_obs_info_header_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Setup common observational info parameters from fits file. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Setup common observational info parameters from fits file.&#39;</span><span class="p">)</span>

        <span class="c1"># get beam widths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HPBW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OIH</span><span class="p">[</span><span class="s1">&#39;HPBW&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FNBW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OIH</span><span class="p">[</span><span class="s1">&#39;FNBW&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;NOMTSYS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OIH</span><span class="p">[</span><span class="s1">&#39;NOMTSYS&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="FitsFileReader.set_noise_cal_header_stats"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_noise_cal_header_stats">[docs]</a>    <span class="k">def</span> <span class="nf">set_noise_cal_header_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Setup common noise header parameters.&quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="s1">&#39;Setup common parameters from fits file noise calibrator.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;CENTFREQ&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BANDWDTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCH</span><span class="p">[</span><span class="s2">&quot;BANDWDTH&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="FitsFileReader.calc_log_freq"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.calc_log_freq">[docs]</a>    <span class="k">def</span> <span class="nf">calc_log_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate the log(frequency) &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Calculating log of frequency&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CENTFREQ&#39;</span><span class="p">]))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;missing &#39;CENTFREQ&#39;, setting it to NAN&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitsFileReader.set_chart_header_stats"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.set_chart_header_stats">[docs]</a>    <span class="k">def</span> <span class="nf">set_chart_header_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup common chart header parameters from fits file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Setting chart header stats&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TSYS1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TSYSERR1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TSYS2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TSYSERR2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TCAL1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s1">&#39;TCAL2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHH</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitsFileReader.get_derived_properties"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_derived_properties">[docs]</a>    <span class="k">def</span> <span class="nf">get_derived_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set the calculated derived of the scan.&quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Getting calculated properties&quot;</span><span class="p">)</span>

        <span class="c1">#self.data[&#39;HA&#39;] = np.mean(self.onScanHDU.data.field(&#39;Hour_Angle&#39;))</span>
        <span class="c1">#self.data[&#39;ZA&#39;] = np.mean(</span>
        <span class="c1">#    self.onScanHDU.data.field(&#39;Dec_J2000&#39;))  </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">HA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;Hour_Angle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ELEVATION</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;Elevation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s1">&#39;MJD&#39;</span><span class="p">)</span>

        <span class="c1"># find centre point of the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MJD</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># get Julian date, elevation, ha and Zenith from center of on source scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MJD</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MID</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HA</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MID</span><span class="p">]</span> <span class="c1"># corrected with help from Jon/Marisa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ELEVATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEVATION</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MID</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELEVATION</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MID</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calc_log_freq</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECTTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_flux</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Calibrate atmosphere</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;13.0S&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrate_nb_Atm</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrate_wb_Atm</span><span class="p">()</span></div>

<div class="viewcode-block" id="FitsFileReader.calc_flux"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.calc_flux">[docs]</a>    <span class="k">def</span> <span class="nf">calc_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculate the source flux for the calibrator.</span>
<span class="sd">            Use the Ott and Baars system.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calculating flux density for the calibrator&quot;</span><span class="p">)</span>

        <span class="n">baars</span> <span class="o">=</span> <span class="p">{</span> 
            <span class="c1"># Baars 1977 paper - J. W. M. Baars, R. Genzel, T. T. K. Pauliny-Toth,A. Witzel, </span>
            <span class="c1"># &#39;The Absolute Spectrum of Cas A; An Accurate Flux Density Scale and a Set of </span>
            <span class="c1"># Secondary Calibrators,&quot; Astronomy &amp; Astrophysics, 61, 1977, pp. 99-106.</span>
            
            <span class="c1">#&quot;CygnusA20M&quot;: {&#39;range_from&#39;: 20, &#39;range_to&#39;: 2000, &#39;a&#39;: 4.695, &#39;b&#39;: 0.085, &#39;c&#39;:-0.178},</span>
            <span class="s2">&quot;CYGNUSA&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">31000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">7.161</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.244</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;TAURUSA&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">3.915</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.299</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;VIRGO A&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">25000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">5.023</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.856</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;3C48&quot;</span>      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.345</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.071</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.138</span><span class="p">},</span>
            <span class="s2">&quot;3C123&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.921</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.124</span><span class="p">},</span>
            <span class="s2">&quot;3C161&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10700</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.633</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.498</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">0.194</span><span class="p">},</span>
            <span class="s2">&quot;HYDRA A&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10700</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.497</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.910</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;3C218&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10700</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.497</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.910</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span> <span class="c1">#aka HYDRA A</span>
            <span class="s2">&quot;3C286&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.480</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.292</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.124</span><span class="p">},</span>
            <span class="s2">&quot;3C348&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10700</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.963</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.052</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;3C353&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10700</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.944</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.034</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.109</span><span class="p">},</span>
            <span class="s1">&#39;DR21&#39;</span>      <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">7000</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">31000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.81</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.122</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;NGC7027&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">31000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.32</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.127</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
              
        <span class="n">ott</span> <span class="o">=</span> <span class="p">{</span> 
            <span class="c1"># OTT 1994 PAPER - M. Ott, A. Quirrenbach, T. P. Krichbaum, K. J. Standke, C. J. Schalinski, and C. A. Hummel,</span>
            <span class="c1"># An updated list of radio flux density calibrators, Astronomy &amp; Astrophysics, 284, 1994, pp. 331-339.</span>

                <span class="s2">&quot;3C48&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">23780</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.465</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.004</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1251</span><span class="p">},</span>
                <span class="s2">&quot;3C123&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">23780</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.525</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.246</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1638</span><span class="p">},</span>
                <span class="s2">&quot;3C147&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">23780</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.806</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.140</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1031</span><span class="p">},</span>
                <span class="s2">&quot;3C161&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.250</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.726</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2286</span><span class="p">},</span>
                <span class="s2">&quot;HYDRA A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.729</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.025</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mf">0.0130</span><span class="p">},</span>
                <span class="s2">&quot;3C218&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.729</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.025</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mf">0.0130</span><span class="p">},</span> <span class="c1">#aka HYDRA A</span>
                <span class="s2">&quot;3C218&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.729</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.025</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mf">0.0130</span><span class="p">},</span>
                <span class="s2">&quot;3C227&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">4750</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">6.757</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.801</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="mf">0.2969</span><span class="p">},</span>
                <span class="s2">&quot;3C249.1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">4750</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.537</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.565</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0404</span><span class="p">},</span>
                <span class="s2">&quot;3C286&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">43200</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">0.956</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.584</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1644</span><span class="p">},</span>
                <span class="s2">&quot;3C295&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">32000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.490</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.756</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2545</span><span class="p">},</span>
                <span class="s2">&quot;3C348&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">3.852</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.361</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1053</span><span class="p">},</span>
                <span class="s2">&quot;3C353&quot;</span>  <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">1408</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">3.148</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.157</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0911</span><span class="p">},</span>
                <span class="s2">&quot;VIRGO A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">4750</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">4.484</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.603</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0280</span><span class="p">},</span> 
                <span class="s2">&quot;CYGNUSA&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">8.360</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">1.565</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
                <span class="s2">&quot;NGC7027&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;range_from&#39;</span><span class="p">:</span> <span class="mi">10550</span><span class="p">,</span> <span class="s1">&#39;range_to&#39;</span><span class="p">:</span> <span class="mi">43200</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.322</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.134</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                <span class="p">}</span>
        
        <span class="c1"># first try Ott then fall back onto Baars</span>
        <span class="c1"># log S[Jy] = a + b*log(freq)[MHz] + c*log**2(freq) [MHz]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ott</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ott</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;range_from&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CENTFREQ&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ott</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;range_to&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">ott</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ott</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]]</span>
                            <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ott</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;c&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">baars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">baars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;range_from&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CENTFREQ&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">baars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;range_to&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">baars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">baars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]]</span>
                        <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">baars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">]][</span><span class="s2">&quot;c&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LOGFREQ&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> - does not have calibration flux density spectral parameters in Ott 1994 or Barrs 1977.&#39;</span><span class="p">)</span></div>
                <span class="c1">#pass</span>
                <span class="c1">#sys.exit()</span>
  
<div class="viewcode-block" id="FitsFileReader.calibrate_nb_Atm"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.calibrate_nb_Atm">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate_nb_Atm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibrate the atmosphere for narrow beam observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calibrate atmosphere.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_atmosphere</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBJECTTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAL&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_jupiter_atm</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;02.5S&#39;</span><span class="p">:</span>
            <span class="c1"># Force jupiter 12.178 GHz data to perform 22 GHz fit</span>
            <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="o">==</span><span class="s2">&quot;02.5S&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">==</span><span class="s2">&quot;Jupiter_12.178GHz&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_atmosphere</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBJECTTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAL&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_jupiter_atm</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_atmosphere</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_12ghz_vars</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_mean_atm_corr</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;06.0D&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;03.5D&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_db_vars</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calibrate_atmosphere</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_zenith_absorption</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_calibrate_atmosphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculate the atmospheric optical depth Tau and brightness temperature Tb at zenith.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PRESSURE&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HUMIDITY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;13.0S&quot;</span><span class="p">:</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_water_vapour</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;02.5S&quot;</span><span class="p">:</span>

                    <span class="c1"># Force jupiter 12.178 GHz data to perform 22 GHz fit</span>
                    <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="o">==</span><span class="s2">&quot;02.5S&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">==</span><span class="s2">&quot;Jupiter_12.178GHz&quot;</span><span class="p">):</span><span class="c1">#,self.scans)</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_12ghz_optical_depths</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_12ghz_brightness_temps</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBJECTTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAL&quot;</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_tau_tb</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;13.0S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_water_vapour</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01.3S&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_22ghz_optical_depths</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_22ghz_brightness_temps</span><span class="p">()</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BEAMTYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;02.5S&quot;</span><span class="p">:</span>

                    <span class="c1"># Force jupiter 12.178 GHz data to perform 22 GHz fit</span>
                    <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="o">==</span><span class="s2">&quot;02.5S&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">==</span><span class="s2">&quot;Jupiter_12.178GHz&quot;</span><span class="p">):</span><span class="c1">#,self.scans)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_22ghz_optical_depths</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_22ghz_brightness_temps</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_12ghz_optical_depths</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_12ghz_brightness_temps</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_calc_water_vapour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate water vapor &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Calculate the water vapour&quot;</span><span class="p">)</span>

        <span class="c1"># ensure PWV and WVD do not go negative! </span>
        <span class="c1"># calculate PWV values - copy from Mikes drift_fits2asc_HINDv16.c file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.39</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HUMIDITY&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">26.23</span><span class="o">-</span><span class="mi">5416</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">]))</span>  <span class="c1"># [mm] precip_water_vapour</span>
        <span class="c1"># [kPa] sat_vap_pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SVP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.611</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="mf">17.27</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">273.13</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">273.13</span><span class="o">+</span><span class="mf">237.3</span><span class="p">))</span>
        <span class="c1"># [kPa] amb_vap_pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SVP&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HUMIDITY&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DPT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DPT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">116.9</span> <span class="o">+</span> <span class="mf">237.3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">16.78</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]))</span>  <span class="c1"># [oC] dew_point_temp</span>
        <span class="c1"># [g/m^3]water_vapour_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WVD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2164.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAMBIENT&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_calc_12ghz_optical_depths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Calculate the optical depths&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_water_vapour</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0071</span> <span class="o">+</span> <span class="mf">0.00021</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">]</span>  <span class="c1"># tau10, from SKA doc, i.e. measurements made in karnavon</span>
        <span class="c1"># tau15, from Meeks 1976 exptl Physics 12B p175</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU15&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.055</span> <span class="o">+</span> <span class="mf">0.004</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WVD&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">4.343</span>
        
    <span class="k">def</span> <span class="nf">_calc_12ghz_brightness_temps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate brightness temperratures.&quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calculate the brightness temperature&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU10&#39;</span><span class="p">]))</span>  <span class="c1"># tbatmos10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS15&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU15&#39;</span><span class="p">]))</span>  <span class="c1"># tbatmos15</span>

<div class="viewcode-block" id="FitsFileReader.calc_tau_tb"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.calc_tau_tb">[docs]</a>    <span class="k">def</span> <span class="nf">calc_tau_tb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate optical depths. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calculate the optical depth&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU221&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0140</span> <span class="o">+</span> <span class="mf">0.00780</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">]</span>  <span class="c1"># tau221 , from SKA doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU2223&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.110</span> <span class="o">+</span> <span class="mf">0.048</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WVD&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">4.343</span>  <span class="c1"># tau222</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS221&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span> <span class="o">*</span> \
            <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU221&#39;</span><span class="p">]))</span>  <span class="c1"># tbatmos221</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS2223&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">260</span> <span class="o">*</span> \
            <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU2223&#39;</span><span class="p">]))</span>  <span class="c1"># tbatmos222</span></div>

    <span class="k">def</span> <span class="nf">_set_water_vapour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set default water vapour estimates to one . &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Set water vapour to default to one&quot;</span><span class="p">)</span>

        <span class="c1"># calculate PWV values - copy from Sunell&#39;s code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># [mm] precip_water_vapour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SVP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># [kPa] sat_vap_pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AVP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># [kPa] amb_vap_pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DPT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># [oC] dew_point_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WVD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># [g/m^3] water_vapour_density</span>

    <span class="k">def</span> <span class="nf">_set_22ghz_optical_depths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set the optical depth at 22 GHz atult to one. &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;set optical depths to default to 1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_water_vapour</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU221&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># tau221</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU2223&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># tau222</span>

    <span class="k">def</span> <span class="nf">_set_22ghz_brightness_temps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set brightness temperature to default to one&quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Set brightness temperature to default to one&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS221&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># tbatmos221</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TBATMOS2223&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># tbatmos222</span>

    <span class="k">def</span> <span class="nf">_calibrate_jupiter_atm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calibrate jupiter atmospheric data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Calibrate jupiter atmospheric data.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_planet_ang_diam</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_jupiter_dist</span><span class="p">()</span>

        <span class="c1"># TODO: Verify this number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;HPBW_ARCSEC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.033</span><span class="o">*</span><span class="mi">3600</span>  <span class="c1"># why 0.033 ?, self.data[&quot;HPBW&quot;]*3600</span>

        <span class="c1"># TODO: VERIFY ADOPTED TB</span>
        <span class="c1"># from Jupiter Tb = 138.2 + 1.6 K = 139.8 K: Gibson, Welch, de Pater 2005, Icarus 173, 439;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ADOPTED_PLANET_TB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">136</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SYNCH_FLUX_DENSITY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4.04</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;JUPITER_DIST_AU&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_ANG_EQ_RAD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_ANG_DIAM&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">3600</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="o">/</span><span class="mf">2.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_SOLID_ANG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_ANG_EQ_RAD&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.935</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;THERMAL_PLANET_FLUX_D&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">1380</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ADOPTED_PLANET_TB&quot;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_SOLID_ANG&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">300</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CENTFREQ&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TOTAL_PLANET_FLUX_D&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SYNCH_FLUX_DENSITY&quot;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;THERMAL_PLANET_FLUX_D&quot;</span><span class="p">]</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TOTAL_PLANET_FLUX_D_WMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">1380</span><span class="o">*</span><span class="mf">135.2</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_SOLID_ANG&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">300</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;CENTFREQ&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SIZE_FACTOR_IN_BEAM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_ANG_DIAM&quot;</span><span class="p">]</span> <span class="o">/</span> \
            <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.935</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;HPBW_ARCSEC&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SIZE_CORRECTION_FACTOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SIZE_FACTOR_IN_BEAM&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> \
            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SIZE_FACTOR_IN_BEAM&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># from ztcal (zenith temperature calibration - read mikes notes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEASURED_TCAL1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">71.4</span> <span class="c1"># zenith measured value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEASURED_TCAL2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">70.1</span> <span class="c1"># check mikes notes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEAS_TCAL1_CORR_FACTOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEASURED_TCAL1&quot;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TCAL1&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEAS_TCAL2_CORR_FACTOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEASURED_TCAL2&quot;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TCAL2&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_tau_tb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ZA_RAD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ZA&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ATMOS_ABSORPTION_CORR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TAU221&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ZA_RAD&quot;</span><span class="p">]))</span>

<div class="viewcode-block" id="FitsFileReader.get_planet_ang_diam"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_planet_ang_diam">[docs]</a>    <span class="k">def</span> <span class="nf">get_planet_ang_diam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get the planet angular diameter from horizon data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">datetime</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Get the planet angular diameter from horizon data.&#39;</span><span class="p">)</span>

        <span class="c1"># Get observation date and split it</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][</span><span class="mi">8</span><span class="p">:])</span>

        <span class="c1"># Get month of date in words</span>
        <span class="n">mydate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>

        <span class="c1"># Open required file and get AU distance for current date</span>
        <span class="n">pathToDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="c1">#print(pathToDir,)</span>
        <span class="n">calNamesDir</span><span class="o">=</span><span class="n">pathToDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;common&#39;</span><span class="p">,</span><span class="s1">&#39;predefs&#39;</span><span class="p">)</span>
        <span class="c1">#print(calNamesDir)</span>
        <span class="c1">#sys.exit()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">calNamesDir</span><span class="o">+</span><span class="s2">&quot;/nasa_jpl_results.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">currentLine</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">obsMonth</span> <span class="o">=</span> <span class="n">mydate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%b&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">currentLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">currentLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">obsMonth</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">int</span><span class="p">((</span><span class="n">currentLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">9</span><span class="p">:])</span> <span class="o">==</span> <span class="n">day</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;PLANET_ANG_DIAM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">currentLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="FitsFileReader.get_jupiter_dist"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_jupiter_dist">[docs]</a>    <span class="k">def</span> <span class="nf">get_jupiter_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Jupiter AU distance from calsky website data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">datetime</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s1">&#39;Get Jupiter AU distance from calsky data&#39;</span><span class="p">)</span>

        <span class="c1"># Get observation date and split it</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;OBSDATE&quot;</span><span class="p">][</span><span class="mi">8</span><span class="p">:])</span>

        <span class="c1"># Get month of date in words</span>
        <span class="n">mydate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>

        <span class="c1"># Get list of files with AU distances</span>
        <span class="n">pathToDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="c1">#print(pathToDir,)</span>
        <span class="n">calNamesDir</span><span class="o">=</span><span class="n">pathToDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;common&#39;</span><span class="p">,</span><span class="s1">&#39;predefs&#39;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">calNamesDir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">calsky_file</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Open required file and get AU distance for current date</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">calNamesDir</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">calsky_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;dat&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">currentLine</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">obsMonth</span> <span class="o">=</span> <span class="n">mydate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%b&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">currentLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">obsMonth</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">currentLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">day</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;JUPITER_DIST_AU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">currentLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="FitsFileReader.convert_counts_to_kelvins"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.convert_counts_to_kelvins">[docs]</a>    <span class="k">def</span> <span class="nf">convert_counts_to_kelvins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Convert counts to antenna temperature.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Converting counts to kelvins&quot;</span><span class="p">)</span>

        <span class="c1">#extract the scan data, convert counts to Kelvins</span>
        <span class="c1">#--------------------------------------------------</span>
        <span class="n">namesOfConversionFactors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># get counts conversion factor, the number of hz per kelvin</span>
            <span class="n">namesOfConversionFactors</span><span class="p">,</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_counts_conversion_factor</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_counts_if_err_in_conversion_factor</span><span class="p">(</span>
                <span class="n">namesOfConversionFactors</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;13.0S&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;BEAMTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;18.0S&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_wb_scans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCANDIST&#39;</span><span class="p">],</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_nb_scans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCANDIST&#39;</span><span class="p">],</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitsFileReader.get_wb_scans"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_wb_scans">[docs]</a>    <span class="k">def</span> <span class="nf">get_wb_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scandist</span><span class="p">,</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the drift scans</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Getting scan data for WB scans&quot;</span><span class="p">)</span>

        <span class="c1"># construct an array for the x-axis in terms of scan offset from the centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">scandist</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">scandist</span><span class="o">/</span>
                                  <span class="mf">2.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;OFFSET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RA_J2000&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span>

        <span class="c1"># TODO: Fix the exceptions and naming convention</span>
        <span class="c1"># if this is a 13cm drift scan, setup 2 scans</span>
        <span class="c1"># Get ONLCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onLcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count1&#39;</span><span class="p">]</span>
            <span class="c1"># Convert to antenna temperature</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onLcp</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onLcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span>

        <span class="c1"># Get ONRCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onRcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onRcp</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onRcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span></div>

    <span class="k">def</span> <span class="nf">_get_counts_conversion_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get counts measured.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Getting counts without errors&quot;</span><span class="p">)</span>
        <span class="n">namesOfConversionFactors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># AS PER GEORGE&#39;S EMAIL:</span>
        <span class="c1"># Low noise diodes are for continuum flux density calibrations and high noise diodes are for spectroscopy</span>
        <span class="c1"># Get noise diode conversion factor LO-NOISE DIODE</span>
        <span class="c1">#lcpHzPerK = self.NCH[&#39;HZPERK1&#39;]</span>
        <span class="c1">#rcpHzPerK = self.NCH[&#39;HZPERK2&#39;]</span>

        <span class="c1"># Get noise diode conversion factor HI-NOISE-DIODE</span>
        <span class="n">lcpHzPerK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HZPERK1&#39;</span><span class="p">]</span>
        <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HZPERK2&#39;</span><span class="p">]</span>

        <span class="n">namesOfConversionFactors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lcpHzPerK&quot;</span><span class="p">)</span>
        <span class="n">namesOfConversionFactors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rcpHzPerK&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">namesOfConversionFactors</span><span class="p">,</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span>

    <span class="k">def</span> <span class="nf">_get_counts_if_err_in_conversion_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get counts, if an error occured these counts will be set to </span>
<span class="sd">        an array of zeros.</span>

<span class="sd">        Args:</span>
<span class="sd">            counts(list): list of observed counts </span>

<span class="sd">        Returns:</span>
<span class="sd">            lcpHzPerK: lcp observed counts</span>
<span class="sd">            rcpHzPerK: rcp observed counts</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot;Getting counts with errors&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># could not find hzperk1</span>
            <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot; MISSING &#39;HZPERK1&#39;, setting to zero&quot;</span><span class="p">)</span>
            <span class="n">lcpHzPerK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCH</span><span class="p">[</span><span class="s1">&#39;HZPERK2&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                            <span class="s2">&quot;MISSING &#39;HZPERK2&#39;, setting to zero&quot;</span><span class="p">)</span>
                <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">])</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># could not find hzperk2</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;lcpHzPerK&quot;</span><span class="p">):</span>
                <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                            <span class="s2">&quot; MISSING &#39;HZPERK2&#39;, setting to zero&quot;</span><span class="p">)</span>
                <span class="n">rcpHzPerK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chartHDU</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span>

<div class="viewcode-block" id="FitsFileReader.get_nb_scans"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.get_nb_scans">[docs]</a>    <span class="k">def</span> <span class="nf">get_nb_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scandist</span><span class="p">,</span> <span class="n">lcpHzPerK</span><span class="p">,</span> <span class="n">rcpHzPerK</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the drift scan counts and convert them to antenna temperature.</span>

<span class="sd">        Args:</span>
<span class="sd">            scandist: Scan length in degrees.</span>
<span class="sd">            lcpHzPerK: Source counts for lcp scan.</span>
<span class="sd">            rcpHzPerK: Source counts for rcp scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Getting scan data for NB scans&quot;</span><span class="p">)</span>

        <span class="c1">#construct an array for the x-axis in terms of scan offset from the centre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">scandist</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span>
                                  <span class="n">scandist</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;OFFSET&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RA_J2000&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span>

        <span class="c1"># for all other drift scans, setup 6 scans</span>
        <span class="c1"># Get HPSLCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hps_lcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanLCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hps_lcp</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span> <span class="o">-</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hps_lcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPSLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanLCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanLCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPSLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanLCP</span>

        <span class="c1"># Get HPNLCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpn_lcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count1&#39;</span><span class="p">]</span>
            <span class="c1"># Convert to antenna temperature</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanLCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hpn_lcp</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span> <span class="o">-</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hpn_lcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPNLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanLCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanLCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPNLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanLCP</span>

        <span class="c1"># Get ONLCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_lcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_lcp</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_lcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">lcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONLCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanLCP</span>

        <span class="c1"># Get HPSRCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hps_rcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanRCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hps_rcp</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span> <span class="o">-</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hps_rcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPSRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanRCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanRCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPSRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpsScanRCP</span>

        <span class="c1"># Get HPNRCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpn_rcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanRCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hpn_rcp</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span> <span class="o">-</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hpn_rcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPNRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanRCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanRCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;HPNRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpnScanRCP</span>

        <span class="c1"># Get ONRCP counts and convert to antenna temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_rcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanHDU</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Count2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_rcp</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_rcp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">rcpHzPerK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="s2">&quot;ONRCP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onScanRCP</span></div>

    <span class="k">def</span> <span class="nf">_calc_zenith_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculation of zenith absorption. </span>
<span class="sd">        </span>
<span class="sd">            Args:</span>
<span class="sd">                data: driftscan parameters&quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot;Calculate zenith absorption&quot;</span><span class="p">)</span>

        <span class="n">dtr</span> <span class="o">=</span> <span class="mf">0.01745329</span> <span class="c1"># where does this number come from??</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SEC_Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dtr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X_Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0045</span> <span class="o">+</span> <span class="mf">1.00672</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SEC_Z&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.002234</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SEC_Z&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.0006247</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SEC_Z&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DRY_ATMOS_TRANSMISSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.0069</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">90</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZA&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZENITH_TAU_AT_1400M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.00610</span> <span class="o">+</span> <span class="mf">0.00018</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ABSORPTION_AT_ZENITH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZENITH_TAU_AT_1400M&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;X_Z&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="FitsFileReader.calibrate_wb_Atm"><a class="viewcode-back" href="../../../docs/src.common.html#src.common.fits_file_reader.FitsFileReader.calibrate_wb_Atm">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate_wb_Atm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate atmosphere for wide beam observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calibrate atmosphere.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ATMOSABS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="mf">0.005</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.017453293</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_add_12ghz_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        parameters found only in 12ghz beams.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Add narrow beam params&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MEAN_ATMOS_CORRECTION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_add_db_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add dual beam parameters &quot;&quot;&quot;</span>

        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="s2">&quot;Add dual beam params&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;SEC_Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;X_Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;DRY_ATMOS_TRANSMISSION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ZENITH_TAU_AT_1400M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ABSORPTION_AT_ZENITH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">_calc_mean_atm_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Calculate the mean atmospheric correction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_wrapper</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                    <span class="s2">&quot;Calculate the mean atmospheric correction&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MEAN_ATMOS_CORRECTION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU15&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TAU10&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">))</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">dran v1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">src.common.fits_file_reader</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Pfesi van Zyl.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    </div>
  </body>
</html>